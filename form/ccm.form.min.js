(function(){var component={name:"form",ccm:"https://akless.github.io/ccm/ccm.js",config:{key:"test",keys:{semester:1,fach:"se"},server:"https://kaul.inf.h-brs.de/data/form.php",user:["ccm.instance","https://akless.github.io/ccm-components/user/versions/ccm.user-1.0.0.min.js",{sign_on:"hbrsinfkaul"}],uml:["ccm.component","../uml/ccm.uml.js"],upload:["ccm.component","../upload/ccm.upload.js"],html:{main:{inner:[{tag:"h2",inner:"Profile"},{tag:"p",inner:[{tag:"span",class:"deadline",inner:"Edit your profile before deadline "}]},{tag:"label",for:"height",inner:"Height"},{tag:"input",id:"height",type:"number",min:100,max:220,step:1,value:175},{tag:"span",inner:"cm"},{tag:"label",for:"weightInput",inner:"Weight"},{tag:"input",id:"weightInput",type:"range",min:0,max:100,value:60,oninput:"weightOutput.value = weightInput.value"},{tag:"output",id:"weightOutput",for:"weightInput",inner:"60"},{tag:"ccm-uml",id:"my_uml",default:"Bob->Alice2 : hello"},{tag:"ccm-upload",id:"my_upload"},{tag:"label",inner:[{inner:"Künstler(in):"},{tag:"select",id:"top5",size:5,multiple:true,inner:[{tag:"option",inner:"Michael Jackson"},{tag:"option",inner:"Tom Waits"},{tag:"option",inner:"Nina Hagen"},{tag:"option",inner:"Marianne Rosenberg"}]}]},{tag:"h3",inner:"Radio"},{tag:"fieldset",inner:[{tag:"input",type:"radio",id:"rmc",name:"Zahlmethode",value:"Mastercard"},{tag:"label",for:"rmc",inner:" Mastercard"},{tag:"input",type:"radio",id:"rvi",name:"Zahlmethode",value:"Visa"},{tag:"label",for:"rvi",inner:" Visa"},{tag:"input",type:"radio",id:"rae",name:"Zahlmethode",value:"AmericanExpress"},{tag:"label",for:"rae",inner:" AmericanExpress"}]},{tag:"h3",inner:"Checkbox"},{tag:"fieldset",inner:[{tag:"input",type:"checkbox",id:"cmc",name:"Checkbox",value:"Mastercard"},{tag:"label",for:"mc",inner:" Mastercard"},{tag:"input",type:"checkbox",id:"cvi",name:"Checkbox",value:"Visa"},{tag:"label",for:"vi",inner:" Visa"},{tag:"input",type:"checkbox",id:"cae",name:"Checkbox",value:"AmericanExpress"},{tag:"label",for:"ae",inner:" AmericanExpress"}]},{tag:"label",for:"firstname",inner:"First Name"},{tag:"input",type:"text",id:"firstname"},{tag:"label",for:"name",inner:"Name"},{tag:"input",type:"text",id:"name"},{tag:"label",for:"vita",inner:"Vita"},{tag:"textarea",id:"vita",inner:"Your Vita here as a default value"},{id:"dummy",value:"test"},{tag:"button",type:"submit",inner:"Submit!"}]}},language:"de",messages:{en:{deadline_exceeded:"Deadline exceeded.",wrong_file_type:"Wrong file type.",file_too_large:"File too large",success:"Successfully uploaded."},de:{deadline_exceeded:"Deadline überschritten.",wrong_file_type:"Falscher File-Typ.",file_too_large:"Datei zu groß.",success:"Erfolgreich hochgeladen."}},css:["ccm.load","resources/default.css"]},Instance:function(){var self=this;this.start=function(callback){var form=document.createElement("form");if(self.logger)self.logger.log("render");var ccm_ids=[];var element_types={deadline:"DEADLINE",points:"POINTS"};function element_type(id){if(element_types[id])return element_types[id].toUpperCase();else{console.log("Undefined type for "+id);return"TEXT"}}self.ccm.helper.makeIterable(self.root.attributes).map(function(attribute){self[attribute.name]=attribute.value});var localDOM=self.inner;if(!localDOM){localDOM=self.ccm.helper.html(self.html.main)}augmentLocalDOM(localDOM);self.ccm.helper.setContent(self.element,form);function augmentLocalDOM(lightDOM){self.ccm.helper.makeIterable(lightDOM.childNodes).map(function(child){form.appendChild(child)});form.appendChild(self.ccm.helper.html({tag:"input",type:"hidden",name:"key",value:self.key}));Object.keys(self.keys).map(function(key){form.appendChild(self.ccm.helper.html({tag:"input",type:"hidden",name:key,value:self.keys[key]}))});augment(form);function augment(elem){if(elem.id){switch(elem.tagName){case"INPUT":element_types[elem.name||elem.id]=elem.type;if(elem.id&&!elem.name)elem.name=elem.id;break;case"TEXTAREA":element_types[elem.id]="TEXTAREA";elem.name=elem.id;break;case"SELECT":element_types[elem.id]="SELECT";elem.name=elem.id;[].forEach.call(elem.options,function(opt){opt.id=encode_id(opt.value)});break;case"OPTION":element_types[elem.id]="SELECT";elem.id=encode_id(elem.value);break;default:element_types[elem.id]=elem.tagName;if(elem.tagName.startsWith("CCM-")){ccm_ids.push(elem.id)}}}var nodes=elem.children;for(var i=0;i<nodes.length;i++){augment(nodes[i])}}}start_ccm_instances();function start_ccm_instances(){ccm_ids.map(function(id){var elem=self.element.querySelector("#"+id);var component_name=elem.tagName.substr(4,elem.tagName.length).toLowerCase();self[component_name].start({key:self.key,root:elem,value:elem.value,keys:{semester:self.keys.semester,fach:self.keys.fach,id:id}})})}if(self.user)self.user.login(proceed);else proceed();function proceed(){add_node("user");add_node("token");function add_node(name){var node=document.createElement("input");node.setAttribute("type","hidden");node.setAttribute("name",name);node.setAttribute("value",self.user.data()[name]);self.element.querySelector("form").appendChild(node)}var submit_button=self.element.querySelector('button[type="submit"]');submit_button.addEventListener("click",submit,false);function submit(e){var xhr=new XMLHttpRequest;var formData=new FormData(form);prepare_select_values();prepare_checkbox_values();prepare_radio_values();prepare_ccm();xhr.open("POST",self.server,true);xhr.onload=function(){if(this.status===200){if(xhr.response&&JSON.parse(xhr.response).deadline){alert(xhr.statusText)}else{alert(self.messages[self.language].deadline_exceeded)}}else{console.log(xhr.statusText+" "+xhr.responseText)}};xhr.send(formData);e.preventDefault();e.stopPropagation();return false;function prepare_select_values(){var nodeList=form.querySelectorAll("select");for(var i=0;i<nodeList.length;i++){var select_node=nodeList[i];formData.append(select_node.id,JSON.stringify(getSelectValues(select_node)))}function getSelectValues(select){var result=[];var options=select&&select.options;var opt;for(var i=0,iLen=options.length;i<iLen;i++){opt=options[i];if(opt.selected){result.push(opt.id||encode_id(opt.value)||encode_id(opt.text))}}return result}}function prepare_checkbox_values(){var checkboxes=form.querySelectorAll('input[type="checkbox"]');var names=[];for(var i=0;i<checkboxes.length;i++){var name=checkboxes[i].name;if(names.indexOf(name)===-1)names.push(name)}names.map(function(name){var namedNodes=form.querySelectorAll('input[name="'+name+'"]');formData.append(name,JSON.stringify(getCheckedValues(namedNodes)))});function getCheckedValues(checkboxes){var result=[];for(var i=0,n=checkboxes.length;i<n;i++){if(checkboxes[i].checked){result.push(checkboxes[i].id)}}return result}}function prepare_radio_values(){var radios=form.querySelectorAll('input[type="radio"]');for(var i=0;i<radios.length;i++){if(radios[i].checked){formData.append(radios[i].name,radios[i].id)}}}function prepare_ccm(){ccm_ids.map(function(id){var elem=self.element.querySelector("#"+id);elem.ccm_instance.sync();formData.append(elem.id,typeof elem.ccm_instance.value==="string"?elem.ccm_instance.value:JSON.stringify(elem.ccm_instance.value))})}function log_form_data(){for(var pair of formData.entries()){console.log(pair[0]+", "+pair[1])}}}self.ccm.load({url:self.server,params:{key:self.key,user:self.user.data().user,token:self.user.data().token,semester:self.keys.semester,fach:self.keys.fach}},function(record){if(typeof record==="string")record=JSON.parse(record);Object.keys(record).map(assign_values_to_ids);function assign_values_to_ids(rec_key){var rec_type=element_type(rec_key);var rec_val=record[rec_key];if(rec_type==="CHECKBOX"||rec_type==="SELECT"){rec_val=JSON.parse(rec_val)}switch(rec_type){case"RANGE":if(self.element.querySelector("#"+rec_key)){var range_input_elem=self.element.querySelector("#"+rec_key);if(rec_val)range_input_elem.value=rec_val;range_input_elem.oninput()}break;case"RADIO":if(rec_val){var selected_node=self.element.querySelector("#"+rec_val);if(selected_node)selected_node.checked="checked"}break;case"CHECKBOX":if(Array.isArray(rec_val)){rec_val.map(function(id){self.element.querySelector("#"+id).checked="checked"})}else{self.element.querySelector("#"+rec_val).checked="checked"}break;case"SELECT":if(Array.isArray(rec_val)){rec_val.map(function(id){self.element.querySelector("#"+id).selected="selected"})}else{self.element.querySelector("#"+rec_val).checked="selected"}break;case"TEXTAREA":self.element.querySelector("#"+rec_key).innerText=rec_val||self.element.querySelector("#"+rec_key).innerText||"";break;case"DEADLINE":var list=self.element.querySelectorAll(".deadline");for(var i=0;i<list.length;i++){list[i].innerText+=" "+record.deadline}break;case"POINTS":var point_list=self.element.querySelectorAll(".points");for(var i=0;i<point_list.length;i++){point_list[i].innerText+=" (max. "+record.points+" Punkte) "}break;default:if(rec_type&&rec_type.startsWith("CCM")){var ccm_instance=self.element.querySelector("#"+rec_key).ccm_instance;if(ccm_instance)ccm_instance.sync(rec_val)}else if(self.element.querySelector("#"+rec_key)){if(rec_val)self.element.querySelector("#"+rec_key).value=rec_val}}}})}function file_url(args){if(!args.server)args.server=self.server;if(!args.params)args.params=self.keys;Object.assign(args.params,{key:self.key});if(args.id)args.params.id=args.id;var url=args.server;Object.keys(args.params).map(function(key,i){url+=(i===0?"?":"&")+key+"="+args.params[key]});return url}function encode_id(id){return id.replace(/\s/g,"__")}function decode_id(id){return id.replace(/__/g,"  ")}if(callback)callback()}}};function p(){window.ccm[v].component(component)}var f="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[f])window.ccm.files[f]=component;else{var n=window.ccm&&window.ccm.components[component.name];n&&n.ccm&&(component.ccm=n.ccm),"string"==typeof component.ccm&&(component.ccm={url:component.ccm});var v=component.ccm.url.split("/").pop().split("-");if(v.length>1?(v=v[1].split("."),v.pop(),"min"===v[v.length-1]&&v.pop(),v=v.join(".")):v="latest",window.ccm&&window.ccm[v])p();else{var e=document.createElement("script");document.head.appendChild(e),component.ccm.integrity&&e.setAttribute("integrity",component.ccm.integrity),component.ccm.crossorigin&&e.setAttribute("crossorigin",component.ccm.crossorigin),e.onload=function(){p(),document.head.removeChild(e)},e.src=component.ccm.url}}})();